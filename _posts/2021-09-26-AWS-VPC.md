---
title: 'AWS Cloud'
toc: true
toc_sticky: true
header:
  teaser: /assets/images/bio-photo-keyboard-teaser.jpg
categories:
  - AWS
tags:
  - AWS
  - VPC
  - Subnet
  - CIDR 
last_modified_at: 2022-09-26
---

## 으아, 큰일났어요(?)
현재 재직중인 회사에 입사했을 때 AWS를 이용해 서비스가 제공되고 있었다. 그리고 먼저 입사하신 시니어 서버개발자분이 그 당시 문제점을 파악해 개선하시고 그대로 서비스가 운영됐다.

문제는 지금부터인데, 나의 AWS 지식은 EC2 인스턴스를 생성해 보안그룹을 설정하는것이 전부였다. 그런데 시니어 개발자분이 퇴사를 하게 됨에 따라 인수인계를 받아야 했다. 아, 정말 큰일났다(이마짚).

그래도 정말 다행인건, 시니어 개발자분께서 AWS관련 양질의 컨텐츠와 함께 스터디를 진행해주셨다. 덕분에 뜬 구름같이 뭉텅뭉텅 알고 있던 AWS 리소스 개념들이 정리됐고 이를 정리해보고자 한다.

## VPC, Vitual Private Cloud
EC2 인스턴스를 생성해 서버를 올린다고 가정해보자. 이 때, 생성한 EC2 인스턴스를 '어디에' 위치시킬것인가 중요한데 이 때 등장하는 개념이 VPC이다.

AWS에서 VPC를 제공하기 전에는 EC2를 생성하면 위치가 무작위로 지정됐다고 한다.
어차피 SSH접속을 하던, HTTP Request를 보내던 인스턴스 IP만 알고 있다면 위치는 굳이 알 필요 없지만 중요한 점은 내가 생성한 EC2가 다른 AWS 사용자의 EC2와 같은 공간에서 작동하고 있다는 것이다.

위에 언급한것과 달리, 다른 AWS 사용자들과 논리적으로 격리된 공간을 만들기 위해 VPC를 사용한다. 즉, AWS VPC는 사용자 계정 전용 가상 네트워크이다.

VPC를 만들기 위해서 IP주소 범위를 선택하고, Subnet 단위로 나누고, 라우팅 테이블을 설정해 인터넷으로 통신하고, 방화벽을 설정해줘야한다. 아래부터는 각 단계별로 알아보도록 한다. 

## CIDR, Classless Inter-Domain Routing
싸이더 라고도 불리는 이것은, 클래스 없는 도메인간 라우팅 기법인데 AWS에서는 CIDR를 사용한다. 아래 표현식을 한 번 살펴보자. 

```
172.0.0.0/8
```
위 IP 표현식에서 /8이 의미하는 것은, IP 앞 8비트는 항상 고정하고 뒤에 24비트는 변경가능하다는 의미이다. 위와 같이 정의했을 경우 사용가능한 IP개수는 2^24개 이다. 

AWS에서는 RFC1918에 명시된 IP주소를 private하게 사용할 것을 권장한다. 간단하게 RFC 1918을 살펴보면 아래와 같다.
```
10.0.0.0 - 10.255.255.255 (=10.0.0.0/8)
172.16.0.0 - 172.31.255.255 (=172.16.0.0/12)
192.168.0.0 - 192.168.255.255 (=192.168.0.0/16) 
```

## Subnet
VPC를 생성할 때 위에서 언급한 CIDR를 설정하고 난 뒤에 Subnet(부분망)이라는 VPC안의 작은 논리공간을 만들어야 한다. Subnet은 가용 영역마다 각각 만들어 줘야한다.

AWS에서는 아래와 같이 권고한다.
```
/16 VPC (64K address)
/24 Subnets (251 address) > 0,255는 기본적으로 제외되며 1,2,3,245는 AWS에서 관리목적으로 사용한다.
One subnet pre Availty Zone
```

## Internet Gateway
VPC를 덩그러니 생성해놓기만 하면, 인터넷을 사용할 수 없다. 그래서 VPC를 생성한 다음 Internet Gateway를 만들어 인터넷을 사용할 수 있도록 설정할 수 있다. 

## Route Table 
VPC와 Subnet을 만들고 나면, 인터넷 경로들을 만들어 줘야하는데 이것을 Route Table 이라고 한다. 

VPC를 만들면 기본 Route Table이 존재하지만 Subnet은 다른 Route Table을 적용할 수 있다. 이런 특징으로 인해 어떤 Subnet은 인터넷과 완전히 격리시켜 private하게, 어떤 Subnet은 인터넷에 연결하여 public하게 사용할 수 있다.  

## Network ACL : stateless firewalls 
Network ACL은 Subnet 단위로 적용가능하다. 

## Security Group: state-ful firewalls 